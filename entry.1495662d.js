parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"QAnz":[function(require,module,exports) {
var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{l(i.next(e))}catch(t){o(t)}}function a(e){try{l(i.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}l((i=i.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,i,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=2&o[0]?i.return:o[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,o[1])).done)return s;switch(i=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(a){o=[6,a],i=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},n=function(){function n(e){var t=this;this.root=e,this.loading=!1,this.segment_duration=.1,this.cutoff_amplitude=.007,this.normal_rate=2,this.ff_rate=7,this.lookahead_segments=20,this.skip_length=1,this.timeline_canvas_mousedown=this.timeline_canvas_mousedown.bind(this),this.timeline_canvas_mouseup=this.timeline_canvas_mouseup.bind(this),this.timeline_canvas_mousemove=this.timeline_canvas_mousemove.bind(this),this.is_mouse_down_on_timeline=!1,window.addEventListener("resize",function(e){t.timeline_canvas&&t.render_timeline()}),setInterval(function(){t.update()},20),window.addEventListener("keydown",function(e){e.preventDefault(),t.video_element&&("ArrowLeft"===e.key?t.video_element.currentTime-=t.skip_length:"ArrowRight"===e.key&&(t.video_element.currentTime+=t.skip_length))}),e.innerHTML='<div class="file-select">\n                        <div>Drop or select a video file.</div>\n                        <input type="file">\n                      </div>',e.querySelector("input").addEventListener("change",function(e){var n=e.target.files[0];t.handle_file(n)})}return n.prototype.handle_file=function(n){return e(this,void 0,void 0,function(){function e(e,t){i.style.width=Math.round(100*e)+"%",s.textContent=t}var i,s,o,r,a,l,d,u,h,c,v=this;return t(this,function(t){switch(t.label){case 0:if(this.loading)return[2];this.loading=!0,this.video_element=null,this.video_blob=null,this.video_blob_url=null,this.segment_amplitudes=null,this.timeline_canvas=null,this.should_ffs=null,this.visited=null,this.root.innerHTML='<div class="loading">\n                              <div class="title">Processing audio...</div>\n                              <div class="substep"></div>\n                              <div class="progress"><div class="filled"></div></div>\n                            </div>',(i=this.root.querySelector(".loading .progress .filled")).style.width="0%",s=this.root.querySelector(".loading .substep"),t.label=1;case 1:for(t.trys.push([1,5,,6]),e(0,"Initalizing audio context"),this.video_element=document.createElement("video"),this.video_blob=n,this.video_blob_url=URL.createObjectURL(this.video_blob),this.video_element.addEventListener("error",function(e){var t=v.video_element.error.message;v.handle_error(t)}),o=0,r=["keydown","keyup","keypress"];o<r.length;o++)a=r[o],this.video_element.addEventListener(a,function(e){e.preventDefault()});return this.video_element.src=this.video_blob_url,this.video_element.controls=!0,l=new AudioContext,e(0,"Decoding audio"),h=(u=l).decodeAudioData,[4,this.video_blob.arrayBuffer()];case 2:return[4,h.apply(u,[t.sent()])];case 3:return d=t.sent(),e(0,"Analyzing audio"),[4,this.analyze_audio(d,e)];case 4:return t.sent(),e(100,"Building fast forward condition table"),this.build_should_ff_table(),this.timeline_canvas=document.createElement("canvas"),this.timeline_canvas.classList.add("timeline"),this.timeline_canvas.addEventListener("mousedown",this.timeline_canvas_mousedown),[3,6];case 5:return c=t.sent(),this.handle_error(c),[2];case 6:return this.root.innerHTML="",this.root.appendChild(this.video_element),this.root.appendChild(this.timeline_canvas),this.render_timeline(),this.loading=!1,[2]}})})},n.prototype.handle_error=function(e){if(console.error(e),this.loading){var t=this.root.querySelector(".loading");t.classList.add("error"),t.innerHTML='<div class="title">An error occurred.</div><div class="error-content"></div>',t.querySelector(".error-content").textContent=e.toString(),this.loading=!1}else this.root.innerHTML='<div class="loading error"></div>',this.loading=!0,this.handle_error(e)},n.prototype.analyze_audio=function(n,i){return e(this,void 0,void 0,function(){var e,s,o,r,a,l,d,u,h,c,v,m,_,f,p,g,y,b,w;return t(this,function(t){switch(t.label){case 0:for(e=n.sampleRate,s=n.length,o=Math.ceil(this.segment_duration*e),r=[],a=0;a<n.numberOfChannels;a++)r.push(n.getChannelData(a));l=performance.now(),d=[],u=40,h=0,t.label=1;case 1:if(!(h<s))return[3,4];for(c=-1/0,v=0,m=r;v<m.length;v++){for(_=m[v],f=-1/0,p=1/0,g=h;g<h+o;g++)(y=_[g])>f&&(f=y),y<p&&(p=y);(b=f-p)>c&&(c=b)}return d.push(c),(w=performance.now())-l>u?(i(h/s,"Reading samples ("+h+" / "+s+")"),[4,new Promise(function(e,t){return setTimeout(e,0)})]):[3,3];case 2:t.sent(),l=w,t.label=3;case 3:return h+=o,[3,1];case 4:return this.segment_amplitudes=d,[2]}})})},n.prototype.build_should_ff_table=function(){this.should_ffs=[];for(var e=0;e<this.segment_amplitudes.length;e++){for(var t=!0,n=e;n<e+this.lookahead_segments+1&&n<this.segment_amplitudes.length;n++){if(this.segment_amplitudes[n]>this.cutoff_amplitude){t=!1;break}}this.should_ffs.push(t)}this.visited=[];for(e=0;e<this.should_ffs.length;e++)this.visited.push(!1)},n.prototype.current_segment_index=function(){return Math.floor(this.video_element.currentTime/this.segment_duration)},n.prototype.render_timeline=function(){var e=window.devicePixelRatio,t=window.getComputedStyle(this.timeline_canvas),n=parseFloat(t.width),i=parseFloat(t.height),s=Math.floor(n*e),o=Math.floor(i*e);this.timeline_canvas.width=s,this.timeline_canvas.height=o;var r=this.timeline_canvas.getContext("2d");r.strokeStyle="transparent";for(var a=this.current_segment_index(),l=0;l<s;l++){var d=Math.floor(l/s*this.segment_amplitudes.length),u=Math.floor((l+1)/s*this.segment_amplitudes.length);d>=u&&(u=d+1),u>this.segment_amplitudes.length&&(u=this.segment_amplitudes.length),d>=this.segment_amplitudes.length&&(d=this.segment_amplitudes.length-1);var h=!1;if(a>=d&&a<u)r.fillStyle="red";else{for(var c=-1/0,v=d;v<u;v++)c=Math.max(c,this.segment_amplitudes[v]),this.visited[v]&&(h=!0);r.fillStyle=this.color_ramp(c)}r.fillRect(l,0,1,o),h&&(r.fillStyle="red",r.fillRect(l,o/2,1,Math.ceil(o/2)))}},n.prototype.color_ramp=function(e){e>1&&(e=1);var t=Math.round(255*e);return"rgb(0, "+t+", "+(255-t)+")"},n.prototype.update=function(){if(this.timeline_canvas&&this.video_element){this.render_timeline();var e=this.current_segment_index();this.video_element.paused||!this.should_ffs[e]||this.visited[e]?this.video_element.playbackRate=this.normal_rate:this.video_element.playbackRate=this.ff_rate,this.video_element.paused||(this.visited[e]=!0)}},n.prototype.timeline_canvas_mousedown=function(e){null!==this.video_element&&(window.addEventListener("mouseup",this.timeline_canvas_mouseup),window.addEventListener("mousemove",this.timeline_canvas_mousemove),e.preventDefault(),this.timeline_canvas_mousemove(e),document.body.style.cursor="none",this.video_element.style.pointerEvents="none",this.paused_before_mouse_down=this.video_element.paused,this.video_element.pause())},n.prototype.timeline_canvas_mouseup=function(e){window.removeEventListener("mouseup",this.timeline_canvas_mouseup),window.removeEventListener("mousemove",this.timeline_canvas_mousemove),document.body.style.cursor="",this.video_element.style.pointerEvents="",this.paused_before_mouse_down||this.video_element.play()},n.prototype.timeline_canvas_mousemove=function(e){var t=this.timeline_canvas.getBoundingClientRect(),n=e.clientX-t.left,i=t.width;this.video_element.currentTime=this.video_element.duration*(n/i)},n}();function i(e){if("complete"==document.readyState){document.removeEventListener("readystatechange",i);var t=document.createElement("div");t.classList.add("player"),document.body.appendChild(t),s(new n(t))}}function s(e){var t=document.createElement("div");function n(e){e.preventDefault(),e.stopPropagation(),t.remove()}t.classList.add("drop-indicator"),t.innerHTML='<div class="inner">Release to play&hellip;</div>',document.body.addEventListener("drop",function(t){var i;n(t);var s=null===(i=t.dataTransfer)||void 0===i?void 0:i.files[0];e.handle_file(s)}),document.body.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation(),document.body.appendChild(t)}),document.body.addEventListener("dragleave",n),document.body.addEventListener("dragend",n);for(var i=0,s=["dragstart","dragover","drag","drop"];i<s.length;i++){var o=s[i];document.addEventListener(o,function(e){return e.preventDefault()})}}document.addEventListener("readystatechange",i),i(null);
},{}]},{},["QAnz"], null)
//# sourceMappingURL=/entry.1495662d.js.map